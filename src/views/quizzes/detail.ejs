<% layout('layout') -%>
<h1 class="mb-3"><%= quiz.title %></h1>
<p class="text-muted"><%= quiz.category_name %> Â· <%= quiz.difficulty %></p>
<p><%= quiz.description %></p>
<hr/>
<h3>Questions</h3>
<ol>
  <% questions.forEach(q => { %>
    <li class="mb-2"><%= q.prompt %></li>
  <% }) %>
</ol>
<div class="d-flex gap-2 flex-wrap">
  <a class="btn btn-primary" href="/quizzes/<%= quiz.id %>/play">Play this quiz</a>
  <a class="btn btn-outline-info" href="/quizzes/<%= quiz.id %>/leaderboard">Leaderboard</a>
  <% if (typeof isCreator !== 'undefined' && isCreator) { %>
    <button class="btn btn-outline-danger" id="delete-quiz-btn" data-quiz-id="<%= quiz.id %>">Delete Quiz</button>
  <% } %>
</div>

<% if (typeof isCreator !== 'undefined' && isCreator) { %>
<script>
document.getElementById('delete-quiz-btn').addEventListener('click', function() {
  const quizId = this.getAttribute('data-quiz-id');
  if (confirm('Are you sure you want to delete this quiz? This action cannot be undone.')) {
    fetch(`/quizzes/${quizId}`, {
      method: 'DELETE',
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },
      credentials: 'same-origin'
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        window.location.href = '/quizzes';
      } else {
        alert(data.error || 'Failed to delete quiz');
      }
    })
    .catch(err => {
      console.error('Error:', err);
      alert('An error occurred while deleting the quiz');
    });
  }
});
</script>
<% } %>

